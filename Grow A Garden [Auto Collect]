local pickup_enabled = true
local CollectController = require(game:GetService("ReplicatedStorage").Modules.CollectController)
local local_player = game:GetService("Players").LocalPlayer
local workspace_ref = game:GetService("Workspace")

CollectController._lastCollected = 0
CollectController._holding = true
CollectController:_updateButtonState()

local farm_model
for _, descendant in next, workspace_ref:FindFirstChild("Farm"):GetDescendants() do
    if descendant.Name == "Owner" and descendant.Value == local_player.Name then
        farm_model = descendant.Parent and descendant.Parent.Parent
        break
    end
end


task.spawn(function()
    while pickup_enabled and farm_model do
        local plants_folder = farm_model:FindFirstChild("Plants_Physical")
        if plants_folder then
            for _, plant_model in next, plants_folder:GetChildren() do
                if plant_model:IsA("Model") then

                    CollectController._lastCollected = 0
                    CollectController:_updateButtonState()
                    CollectController:Collect(plant_model) 

                    for _, object in next, plant_model:GetDescendants() do
                        CollectController._lastCollected = 0
                        CollectController:_updateButtonState()
                        CollectController:Collect(object)
                        task.wait(0.01) 
                    end
                end
            end
        end
        task.wait(0.1) 
    end
end)
